---
title: Wildcard SSL Certificates
description: Generate valid wildcard SSL certificates for homelab services using local DNS, Traefik, and Cloudflare
tags:
- traefik
- cloudflare
---

After setting up a home network, I wanted a way to access my services using domain names with valid SSL certificates, avoiding browser warnings from self-signed certificates. By combining local DNS records, Traefik as a reverse proxy, and Cloudflare for DNS, you can create a seamless, secure setup.

## Setup Traefik
For the initial Traefik and Cloudflare API setup, check out the [Setup & Configuration][install-setup] guide. 

## Local DNS Configuration
To route traffic from your local devices to Traefik, you need to create a wildcard DNS record in your local DNS server. Instead of creating individual records for each service, a wildcard DNS record (e.g., `*.lab.example.com`) will route all subdomains to your Traefik instance, which handles SSL certificates and reverse proxy routing.

You can configure this in various DNS solutions:

- **Unifi**: Policy Table DNS records
- **Pi-hole**: Local DNS Records
- **AdGuard Home**: DNS rewrites
- **pfSense/OPNsense**: Host overrides
- **Router DNS**: Custom DNS entries (if supported)

??? example "Unifi Controller Setup"
    In your Unifi controller:

    1. Navigate to **Settings** â†’ **Policy Table**
    2. Click **Create New Policy**
    3. Select **DNS** as the policy type
    4. Enter the domain name: `*.lab.example.com`
    5. Enter the IP address of your server running Traefik
    6. Click **Add** to save

## Service Labels
Traefik uses Docker labels to discover services and configure routing. Add the following labels to each container you want to expose through Traefik:

```yaml title="docker-compose.yml"
labels:
  - "traefik.enable=true"
  - "traefik.http.routers.<service-name>.entrypoints=websecure"
  - "traefik.http.routers.<service-name>.rule=Host(`<service-name>.${DOMAIN}`)" # (1)!
  - "traefik.http.routers.<service-name>.tls=true"
  - "traefik.http.routers.<service-name>.tls.certresolver=le"
  - "traefik.http.routers.<service-name>.tls.domains[0].main=${DOMAIN}" # (2)!
  - "traefik.http.routers.<service-name>.tls.domains[0].sans=*.${DOMAIN}"
  - "traefik.http.services.<service-name>.loadbalancer.server.port=<port>"  # (3)!
```

1. :material-tag: **Service Name** - Replace `<service-name>` with a unique name for your service
2. :material-web: **Domain** - `${DOMAIN}` should be set in your `.env` file to your main domain
3. :material-network: **Port** - Replace `<port>` with the port your container exposes internally

The wildcard certificate will automatically be generated by Traefik using the Cloudflare DNS challenge, covering all services under your wildcard domain.

## Accessing the Traefik Dashboard

To access the Traefik dashboard with a valid SSL certificate, you need to enable the API and add labels to the Traefik container.

### Enable Traefik API

Ensure the API is enabled in your Traefik `docker-compose.yml` command flags:

```yaml title="docker-compose.yml"
command:
  # ... existing commands ...
  - "--api.insecure=false"
  - "--api=true"
  - "--api.dashboard=true"
```

!!! note ""
    Setting `api.insecure=false` ensures the dashboard is only accessible through defined routers, not directly on port 8080.

### Add Dashboard Labels

Add the following labels to your Traefik container in your `docker-compose.yml`:

```yaml title="docker-compose.yml"
labels:
  - "traefik.enable=true"
  - "traefik.http.routers.traefik.entrypoints=websecure"
  - "traefik.http.routers.traefik.rule=Host(`traefik.${DOMAIN}`)"
  - "traefik.http.routers.traefik.tls=true"
  - "traefik.http.routers.traefik.tls.certresolver=le"
  - "traefik.http.routers.traefik.tls.domains[0].main=${DOMAIN}"
  - "traefik.http.routers.traefik.tls.domains[0].sans=*.${DOMAIN}"
  - "traefik.http.routers.traefik.service=api@internal"
```

The `api@internal` service is a special Traefik service that routes to the built-in dashboard. With `${DOMAIN}` set to `example.com`, you can access the dashboard at `https://traefik.example.com` with a valid SSL certificate.

## How It Works

When you navigate to `portainer.lab.example.com` in your browser:

1. **DNS Resolution**: Your local DNS server resolves the domain to your Traefik server's local IP address
2. **Traffic Routing**: Traefik receives the request and routes it to the appropriate container based on the host rule
3. **SSL Certificate**: Traefik serves the connection with a valid wildcard SSL certificate obtained through Cloudflare's DNS challenge

No more browser warnings, just secure, local access to all your homelab services!

[install-setup]: install-setup
